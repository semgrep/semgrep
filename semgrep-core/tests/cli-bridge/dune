; Program to test semgrep_bridge_core.so from C.
(rule
  (target bridge_test.exe)
  (deps
    bridge_test.c
    ../../src/cli-bridge/semgrep_bridge_core.so
  )
  (action
    (run %{cc} -o %{target} %{deps}

      ; Point at directory containing bridge_ml.h.
      -I ../../src/cli-bridge

      ; Avoid the need to specify LD_LIBRARY_PATH in the test below.
      -Wl,-rpath=../../src/cli-bridge

      -ldl -lm)
  )
)

(rule
  (alias runtest)
  (deps
    bridge_test.exe
  )
  (action
    (run ./bridge_test.exe -version)
  )
)
