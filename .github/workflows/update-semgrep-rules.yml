# AUTOGENERATED FROM update-semgrep-rules.jsonnet DO NOT MODIFY
"on":
  workflow_dispatch: {}
  push:
    branches:
      - cron
  schedule:
    - cron: 0 0 * * 0,2,4
jobs:
  update-semgrep-rules-submodule:
    runs-on: ubuntu-latest
    steps:
      - name: Get JWT for semgrep-ci GitHub App
        id: jwt
        uses: docker://public.ecr.aws/y9k7q4m1/devops/cicd:latest
        env:
          EXPIRATION: 600
          ISSUER: ${{ secrets.SEMGREP_CI_APP_ID }}
          PRIVATE_KEY: ${{ secrets.SEMGREP_CI_APP_KEY }}
      - name: Get token for semgrep-ci GitHub App
        id: token
        run:
          "\n      TOKEN=\"$(curl -X POST \\\n      -H \"Authorization: Bearer ${{
          steps.jwt.outputs.jwt }}\" \\\n      -H \"Accept: application/vnd.github.v3+json\"
          \\\n      \"https://api.github.com/app/installations/${{ secrets.SEMGREP_CI_APP_INSTALLATION_ID
          }}/access_tokens\" | \\\n      jq -r .token)\"\n      echo \"::add-mask::$TOKEN\"\n
          \     echo \"token=$TOKEN\" >> $GITHUB_OUTPUT\n    "
      - uses: actions/checkout@v3
        with:
          submodules: recursive
          ref: ${{ github.event.repository.default_branch }}
          token: ${{ steps.token.outputs.token }}
      - name: Update semgrep-rules (the main purpose of this workflow)
        run: make update_semgrep_rules
        env:
          GITHUB_TOKEN: ${{ steps.token.outputs.token }}
      - run: git status
      - name: Creating the branch and commiting to it
        env:
          GITHUB_TOKEN: ${{ steps.token.outputs.token }}
          BRANCHNAME:
            update-semgrep-rules-${{ github.run_id }}-${{ github.run_attempt
            }}
        run:
          "\n        git checkout -b $BRANCHNAME\n        git config user.name \"GitHub
          Actions Bot\"\n        git config user.email \"<>\"\n        git commit -a
          -m\"update semgrep rules\"\n        git push origin $BRANCHNAME\n      "
      - name: Create the Pull request with gh
        env:
          GITHUB_TOKEN: ${{ steps.token.outputs.token }}
        run:
          "\n        gh pr create --title 'Cron - update semgrep-rules' --body 'Please
          confirm correctness of the changes here and ensure all tests pass. This PR
          was autogenerated by .github/workflows/update-semgrep-rules.yml' --base develop\n
          \     "
