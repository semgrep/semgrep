# Makefile to automatically convert the .jsonnet GHA workflows
# to .yml as GHA accepts only this format.
#
# To convert more yml files to jsonnet, install 'yq' and 'jsonnetfmt'
# and run `jsonnetfmt <(cat foo.yml | yq)` to get a first draft.

# you need to 'make build-ojsonnet' to get this binary
JSONNET=../../bin/ojsonnet

OBJS = \
  semgrep.yml lint.yml update-semgrep-rules.yml \
  build-test-core-x86.yml build-test-core-x86-ocaml5.yml \
  build-test-osx-x86.yml build-test-osx-arm64.yml \
  build-test-manylinux-x86.yml build-test-manylinux-aarch64.yml \
  build-test-javascript.yml \
  tests.yml

all: $(OBJS)

%.yml: %.jsonnet
	echo "# AUTOGENERATED FROM $< DO NOT MODIFY" > $@
	$(JSONNET) --yaml $^ >> $@

clean:
	rm -f $(OBJS)
