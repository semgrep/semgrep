# Workflow to manually revert the semgrep 'latest' docker image
# to a previous version.

name: Revert Semgrep Docker Image

on:
  workflow_dispatch:
    inputs:
      docker_tag:
        description: "Docker Tag to point 'latest' to, example: 0.100.0"
        required: true

jobs:
  rollback-docker-image:
    name: Rollback returntocorp/semgrep Docker Image
    runs-on: ubuntu-22.04
    steps:
      - uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
      - run: |
          docker pull returntocorp/semgrep:${{ inputs.docker_tag }}
          docker tag  returntocorp/semgrep:${{ inputs.docker_tag }} returntocorp/semgrep:latest
          docker push returntocorp/semgrep:latest
