# AUTOGENERATED FROM build-test-core-x86.jsonnet DO NOT MODIFY
jobs:
  job:
    container: returntocorp/ocaml:alpine-2024-03-07
    env:
      HOME: /root
    runs-on: ubuntu-latest
    steps:
      - name: Make checkout speedy
        run: git config --global fetch.parallel 50
      - uses: actions/checkout@v3
        with:
          submodules: true
      - name: Configure git safedir properly
        run: git config --global --add safe.directory $(pwd)
      - env:
          SEGMENT_DOWNLOAD_TIMEOUT_MINS: 2
        name: Set GHA cache for OPAM in ~/.opam
        uses: actions/cache@v3
        with:
          key: ${{ runner.os }}-${{ runner.arch }}-opam-deps-4.14.0-${{hashFiles('semgrep.opam')}}
          path: ~/.opam
      - name: Install dependencies
        run: |
          eval $(opam env)
          make install-deps-ALPINE-for-semgrep-core
          make install-deps-for-semgrep-core
      - name: Build semgrep-core
        run: opam exec -- make core
      - name: Make artifact
        run: |
          mkdir -p ocaml-build-artifacts/bin
          cp bin/semgrep-core ocaml-build-artifacts/bin/
          tar czf ocaml-build-artifacts.tgz ocaml-build-artifacts
      - uses: actions/upload-artifact@v3
        with:
          name: ocaml-build-artifacts-release
          path: ocaml-build-artifacts.tgz
      - name: Test semgrep-core
        run: opam exec -- make core-test
name: build-test-core-x86
on:
  workflow_call: null
  workflow_dispatch: null
