# AUTOGENERATED FROM lint.jsonnet DO NOT MODIFY
name: lint
"on":
  workflow_dispatch:
  pull_request:
  push:
    branches:
    - develop
jobs:
  pre-commit:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Configure git safedir properly
      run: git config --global --add safe.directory $(pwd)
    - name: Fetch semgrep-cli submodules
      run: git submodule update --init --recursive --recommend-shallow cli/src/semgrep/semgrep_interfaces
    - uses: actions/setup-python@v4
      with:
        python-version: "3.11"
        cache: pip
        cache-dependency-path: .github/workflows/lint.yml
    - uses: pre-commit/action@v3.0.0
      env:
        SKIP_OCAMLFORMAT: "yes"
  pre-commit-manual:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Configure git safedir properly
      run: git config --global --add safe.directory $(pwd)
    - uses: pre-commit/action@v3.0.0
      with:
        extra_args: --hook-stage manual
  pre-commit-ocaml:
    runs-on: ubuntu-latest
    container: returntocorp/ocaml:ubuntu-2023-10-17
    steps:
    - uses: actions/checkout@v3
    - name: Check OCaml code with ocamlformat
      env:
        HOME: /root
      run: "\n          # When installing ocamlformat.0.26.1 OPAM will try to rebuild
        some packages\n          # and for that it requires 'autoconf'.\n          apt-get
        install -y autoconf\n          opam install -y ocamlformat.0.26.1\n          git
        config --global --add safe.directory \"$GITHUB_WORKSPACE\"\n          opam
        exec -- pre-commit run --verbose --all lint-ocaml\n        "
  github-actions:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Configure git safedir properly
      run: git config --global --add safe.directory $(pwd)
    - uses: actions/setup-go@v4
      with:
        go-version: "1.19"
    - run: go install github.com/rhysd/actionlint/cmd/actionlint@v1.6.25
    - run: actionlint -shellcheck=''
