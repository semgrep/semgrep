# AUTOGENERATED FROM release-homebrew.jsonnet DO NOT MODIFY
name: release-homebrew
"on":
  workflow_dispatch:
jobs:
  homebrew-core-pr:
    runs-on: macos-12
    steps:
    - run: brew update
    - run: python3 -m pip install -q --disable-pip-version-check --dry-run --ignore-installed
        --report=/dev/stdout semgrep==1.55.1
    - name: Open Brew PR
      env:
        HOMEBREW_GITHUB_API_TOKEN: ${{ secrets.SEMGREP_HOMEBREW_RELEASE_PAT }}
        HOMEBREW_NO_INSTALL_FROM_API: 1
      run: "\n        brew bump-formula-pr --force --no-audit --no-browse --write-only
        \\\n          --message=\"semgrep 1.55.1\" \\\n          --tag=\"v1.55.1\"
        semgrep --debug\n      "
    - name: Prepare Branch
      env:
        GITHUB_TOKEN: ${{ secrets.SEMGREP_HOMEBREW_RELEASE_PAT }}
        R2C_HOMEBREW_CORE_FORK_HTTPS_URL: https://github.com/semgrep-release/homebrew-core.git
      run: "\n        cd \"$(brew --repository)/Library/Taps/homebrew/homebrew-core\"\n
        \       git status\n        git diff\n        git config user.name ${{ github.actor
        }}\n        git config user.email ${{ github.actor }}@users.noreply.github.com\n
        \       gh auth setup-git\n        git remote add r2c \"${R2C_HOMEBREW_CORE_FORK_HTTPS_URL}\"\n
        \       git checkout -b bump-semgrep-1.55.1\n        git add Formula/s/semgrep.rb\n
        \       git commit -m \"semgrep 1.55.1\"\n      "
    - name: Push Branch to Fork
      env:
        GITHUB_TOKEN: ${{ secrets.SEMGREP_HOMEBREW_RELEASE_PAT }}
      run: "\n        cd \"$(brew --repository)/Library/Taps/homebrew/homebrew-core\"\n
        \       git push --set-upstream r2c --force \"bump-semgrep-1.55.1\"\n      "
    - name: Push to Fork
      env:
        GITHUB_TOKEN: ${{ secrets.SEMGREP_HOMEBREW_RELEASE_PAT }}
        R2C_HOMEBREW_CORE_OWNER: semgrep-release
      run: "\n        gh pr create --repo homebrew/homebrew-core \\\n          --base
        master --head \"${R2C_HOMEBREW_CORE_OWNER}:bump-semgrep-1.55.1\" \\\n          --title=\"semgrep
        1.55.1\" \\\n          --body \"Bump semgrep to version 1.55.1\"\n      "
